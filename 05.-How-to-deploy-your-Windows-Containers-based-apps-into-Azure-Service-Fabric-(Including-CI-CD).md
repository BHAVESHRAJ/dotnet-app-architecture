##  Overview
Applications based on Windows Containers will soon need to use platforms going further from IaaS VMs in order to easily achieve a better automated scalability, high scalability and significant improvement in automated deployments and versioning. You can achieve those goals with the orchestrator Azure Service Fabric, available in Microsoft Azure cloud but also on-premises or even in any other public cloud you’d like to deploy it.

##  Goals for this walkthrough
This post describes how to deploy eShopModernizedMVC to Kubernetes but deploying the eShopModernizedWebForms should be pretty similar, so you can use almost the same procedure but using different deployment .yml files.

Learn how to deploy a Windows Container based application into a Service Fabric cluster in Azure. Deploying to Service Fabric, from scratch, requires a 2-step process:
1. Deploy a Service Fabric cluster into Azure (Or any other environment)
2. Deploy the application and related resources into the Service Fabric cluster

However, before trying this scenario deploying to an orchestrator, it is recommended that you:
1. Familiarize yourself with the previous sections about containerizing existing .NET Framework apps.
2. You’ve been testing the sample applications (eShopModernizedMVC and/or eShopModernizedWebForms) and running them on a local Docker for Windows dev machine.

##  Scenario

### Scenario A: Direct deployment to Service Fabric cluster from development environment
![image](https://user-images.githubusercontent.com/1712635/30446445-094e998a-993e-11e7-96d8-ed1dd9fef142.png)

### Scenario B: Deployment to to Service Fabric cluster from from CI/CD pipelines in VSTS

TBD


## Prerequisites
- Have ready an Azure subscription
- Have ready a Visual Studio Team Services account (Optional, if deploying from VSTS CD pipeline)
- Visual Studio 2017 on dev machine (Recommended and needed for this specific walkthorugh)
- Access to eShopModernizedMVC image at [Docker Hub](https://hub.docker.com/) (or any other Docker Registry like Azure Container Registry)
- Install Docker CE for Windows so that you can run containers on Windows 10 (dev machine).
- Install Azure PowerShell
- [Service Fabric Tools](https://blogs.msdn.microsoft.com/azureservicefabric/2017/03/17/visual-studio-2017-and-service-fabric-tools/) are part of the “Azure Development and Management” [workload](https://www.visualstudio.com/vs/visual-studio-workloads/) in Visual Studio 2017. Enable this workload as part of your Visual Studio installation.
- Install Microsoft [Azure Service Fabric SDK](http://www.microsoft.com/web/handlers/webpi.ashx?command=getinstallerredirect&appid=MicrosoftAzure-ServiceFabric-CoreSDK) or higher through the Platform Installer
- Install the [Continuous Delivery Tools extension](https://aka.ms/cd4vs) for Visual Studio 2017 (Optional. Needed for deployment from CD pipeline from VSTS)

It is important that you must, in the first place, have tested either the eShopModernizedMVC or eShopModernizedWebForms container in a local Docker for Windows environment so it is now ready to be built and packaged in a Service Fabric application.

## Have the eShopModernizedMVC or eShopModernizedWebForms Docker image ready at any Docker Registry

Once you have the container image built on your machine, you can push it to any container registry (like Docker Hub or Azure Container Registry) so Service Fabric will be able to pull it down and deploy it as a Windows Container.
If you want to publish your own images, follow a similar procedure than this one used in the "Deployment to VMs" post: [Publish the image in a Docker Registry](https://github.com/dotnet-architecture/eShopModernizing/wiki/03.-How-to-deploy-your-Windows-Containers-based-app-into-Azure-VMs-(Including-CI-CD)#publish-the-image-in-a-docker-registry-docker-hub-of-azure-container-registry).

However, and for simplicity's sake, you can also use the public eShopModernized Docker images available at Docker Hub and published by our team. Those images are available here:

**eShopModernizedMVC Windows Docker Image:** [https://hub.docker.com/r/eshop/modernizedmvc/](https://hub.docker.com/r/eshop/modernizedmvc/) 

**eShopModernizedWebForms Windows Docker Image:** [https://hub.docker.com/r/eshop/modernizedmvc/](https://hub.docker.com/r/eshop/modernizedmvc/) 

So, you'd be able to deploy those images by simply using the current dockerfiles in the solution which are referencing to these image names:

    `eshop/modernizedmvc`

    `eshop/modernizewebforms`





## Deploying from VSTS CD pipeline to Service Fabric  
- TBD (Plain)



